{"ast":null,"code":"var _jsxFileName = \"/Users/ksena/\\u041F\\u0440\\u043E\\u0433\\u0440\\u0430\\u043C\\u043C\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u0438\\u0435/React/lessons/Shop_1001/client/src/component/bookList/BookList.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useCallback, useContext, useEffect } from 'react';\nimport { DEFAULT_PAGE_LIMIT } from '../../constants/pageLimit';\nimport { BasketContext } from '../../context/BasketContext';\nimport { FilterSortContext } from '../../context/FilterSortContext';\nimport { useHttp } from '../../hooks/http.hook';\nimport { formatQueryString, formatQueryStringFilter } from '../../utils/formatQueryString';\nimport { normalizeBooks } from '../../utils/normalizeBooks';\nimport { LoadingCircular } from '../loading/LoadingCircular';\nimport { BookItem } from './BookItem';\nimport './style.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const BookList = _ref => {\n  _s();\n\n  let {\n    books,\n    currentPage,\n    setCurrentPage,\n    totalCount,\n    setTotalCount,\n    setBooks,\n    userAuth\n  } = _ref;\n  const {\n    addBookToBasket\n  } = useContext(BasketContext);\n  const {\n    loading,\n    request\n  } = useHttp();\n  const {\n    sortField,\n    sortOrder,\n    applyFilter,\n    searchText\n  } = useContext(FilterSortContext);\n  const filter = formatQueryStringFilter(applyFilter);\n  useEffect(() => {\n    showBooks();\n  }, [sortField, sortOrder, applyFilter, searchText]);\n  const showBooks = useCallback(async function () {\n    let limit = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_PAGE_LIMIT;\n    const result = await request({\n      url: formatQueryString(`books/show-books/${(userAuth === null || userAuth === void 0 ? void 0 : userAuth.userId) || 0}`, {\n        limit,\n        page: currentPage,\n        sortField,\n        sortOrder,\n        filter,\n        searchText\n      })\n    });\n    setTotalCount(result.totalCount);\n    setBooks([...books, ...normalizeBooks(result.data)]);\n    setCurrentPage(prevState => prevState + 1);\n  }, [request, currentPage, sortField, sortOrder, searchText, applyFilter]);\n  const handleScroll = useCallback(_ref2 => {\n    let {\n      target\n    } = _ref2;\n    if (totalCount <= books.length || loading) return;\n    const {\n      scrollTop,\n      scrollHeight\n    } = target;\n    const fetchingHeight = scrollHeight - (scrollTop + window.innerHeight);\n\n    if (fetchingHeight < 100) {\n      showBooks();\n    }\n  }, [books.length, loading, totalCount]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [loading && /*#__PURE__*/_jsxDEV(LoadingCircular, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 25\n    }, this), !!books.length ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wrapperBookList\",\n      onScroll: handleScroll,\n      children: books.map(book => /*#__PURE__*/_jsxDEV(BookItem, {\n        book: book,\n        addBookToBasket: addBookToBasket\n      }, book.idBook, false, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 25\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 19\n    }, this) : /*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"No books..\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 19\n    }, this)]\n  }, void 0, true);\n};\n\n_s(BookList, \"qL29+FmBwS8X19gjmMumzLp/7+w=\", false, function () {\n  return [useHttp];\n});\n\n_c = BookList;\n\nvar _c;\n\n$RefreshReg$(_c, \"BookList\");","map":{"version":3,"names":["React","useCallback","useContext","useEffect","DEFAULT_PAGE_LIMIT","BasketContext","FilterSortContext","useHttp","formatQueryString","formatQueryStringFilter","normalizeBooks","LoadingCircular","BookItem","BookList","books","currentPage","setCurrentPage","totalCount","setTotalCount","setBooks","userAuth","addBookToBasket","loading","request","sortField","sortOrder","applyFilter","searchText","filter","showBooks","limit","result","url","userId","page","data","prevState","handleScroll","target","length","scrollTop","scrollHeight","fetchingHeight","window","innerHeight","map","book","idBook"],"sources":["/Users/ksena/Программирование/React/lessons/Shop_1001/client/src/component/bookList/BookList.tsx"],"sourcesContent":["import React, { Dispatch, FC, SetStateAction, UIEvent, useCallback, useContext, useEffect } from 'react'\n\nimport { DEFAULT_PAGE_LIMIT } from '../../constants/pageLimit'\nimport { BasketContext } from '../../context/BasketContext'\nimport { FilterSortContext } from '../../context/FilterSortContext'\nimport { useHttp } from '../../hooks/http.hook'\nimport { IBook } from '../../interface/IBook'\nimport { IUser } from '../../interface/IUser'\nimport { formatQueryString, formatQueryStringFilter } from '../../utils/formatQueryString'\nimport { normalizeBooks } from '../../utils/normalizeBooks'\nimport { LoadingCircular } from '../loading/LoadingCircular'\nimport { BookItem } from './BookItem'\n\nimport './style.css'\n\ntype Props = {\n    books: IBook[],\n    currentPage: number, \n    setCurrentPage: Dispatch<SetStateAction<number>>, \n    totalCount: number, \n    setTotalCount: Dispatch<SetStateAction<number>>, \n    setBooks: Dispatch<SetStateAction<IBook[]>>, \n    userAuth?: IUser,\n}\n\nexport const BookList: FC<Props> = ({ books, currentPage, setCurrentPage, totalCount, setTotalCount, setBooks, userAuth }) => {\n    const { addBookToBasket } = useContext(BasketContext)\n    \n    const { loading, request } = useHttp()\n    \n    const { sortField, sortOrder, applyFilter, searchText } = useContext(FilterSortContext)\n\n    const filter = formatQueryStringFilter(applyFilter)\n\n    useEffect(() => {\n        showBooks()\n    }, [sortField, sortOrder, applyFilter, searchText])\n    \n    const showBooks = useCallback(async(limit = DEFAULT_PAGE_LIMIT) => {\n        const result = await request({ url: formatQueryString(`books/show-books/${userAuth?.userId || 0}`, { \n            limit, \n            page: currentPage, \n            sortField,\n            sortOrder,\n            filter,\n            searchText\n        }) })\n        \n        setTotalCount(result.totalCount)\n        setBooks([...books, ...normalizeBooks(result.data)])\n        setCurrentPage(prevState => prevState + 1)\n    }, [request, currentPage, sortField, sortOrder, searchText, applyFilter])\n    \n    const handleScroll = useCallback( ({ target }: UIEvent<HTMLDivElement>) => {\n        if (totalCount <= books.length || loading) return\n        const { scrollTop, scrollHeight } = target as HTMLDivElement\n        const fetchingHeight = scrollHeight - (scrollTop + window.innerHeight)\n\n        if (fetchingHeight < 100) {\n            showBooks()\n        }\n    }, [books.length, loading, totalCount])\n\n    return (\n        <>\n            {loading && <LoadingCircular />}  \n            {!!books.length \n                ? <div className=\"wrapperBookList\" onScroll={handleScroll}>\n                    {books.map(book => \n                        <BookItem\n                            key={book.idBook}\n                            book={book}\n                            addBookToBasket={addBookToBasket}\n                        />\n                    )}\n                </div>\n                : <h2>No books..</h2>\n            }\n        </>\n    )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}